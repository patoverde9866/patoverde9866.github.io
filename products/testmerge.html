<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proceso de Compra Multi-Paso</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js';
        import { getStorage, ref, uploadBytes } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-storage.js';
      
        // Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyD6CNwuebJ9Dhb_fkj9pVxDYQh28B2QDzk",
          authDomain: "tiitox-a2b13.firebaseapp.com",
          projectId: "tiitox-a2b13",
          storageBucket: "tiitox-a2b13.firebasestorage.app",
          messagingSenderId: "349047156972",
          appId: "1:349047156972:web:d4a16de0d1c9196c92b5c9"
        };
      
        // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    // Define the uploadFileToFirebase function and attach it to the window object
    window.uploadFileToFirebase = async function uploadFileToFirebase() {
    const fileInput = document.getElementById('comprobante');
    const status = document.getElementById('uploadStatus');
    const file = fileInput.files[0];

    if (!file) {
        alert('Por favor, seleccione un archivo.');
        return false;
    }

    status.textContent = 'Subiendo...';

    try {
        const uniqueName = `${Date.now()}-${file.name}`; // Generate a unique file name
        const fileRef = ref(storage, `uploads/${uniqueName}`); // Use the unique name
        await uploadBytes(fileRef, file);

        // Generate a public URL for the uploaded file
        const fileUrl = `https://firebasestorage.googleapis.com/v0/b/${firebaseConfig.storageBucket}/o/uploads%2F${encodeURIComponent(uniqueName)}?alt=media`;

        // Gather summary details
        const nombre = document.getElementById('nombre').value;
        const apellido = document.getElementById('apellido').value;
        const celular = document.getElementById('celular').value;
        const direccion = document.getElementById('direccion').value;
        const ciudad = document.getElementById('ciudad').value;
        const referencia = document.getElementById('referencia').value;
        const email = document.getElementById('email').value;
        const totalPrice = document.getElementById('product-price').textContent;

        // Gather product details
        const productName = document.getElementById('product-name').textContent;
        const colorName = document.getElementById('product-color').textContent;
        const productQuantity = document.getElementById('product-quantity').textContent;

        // Notify Telegram after successful upload
        fetch("https://notifytelegram-llggzgzsua-uc.a.run.app", {
            method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({
        fileUrl: fileUrl, // Pass the uploaded file's URL
        message: `‚úÖ Nueva Venta!\n\n**Resumen del Producto**:\nüì¶ Producto: ${productName}\nüé® Color: ${colorName}\nüî¢ Cantidad: ${productQuantity}\nüë§ Nombre: ${nombre} ${apellido}\nüìû Celular: ${celular}\nüìç Direcci√≥n: ${direccion}, ${ciudad}\nüìß Correo: ${email}\nüí¨ Referencia: ${referencia}\nüí∞ Total Pagado: ${totalPrice}\nüìÑ Comprobante: ${fileUrl}`
    })
});

        status.textContent = 'Archivo subido exitosamente.';
        console.log('Archivo subido:', uniqueName);
        console.log('Archivo URL:', fileUrl);
        return true;
    } catch (error) {
        status.textContent = 'Error al subir el archivo.';
        console.error('Error de subida:', error);
        alert(`Error al subir el archivo: ${error.message}`);
        return false;
    }
};
      </script>
    <style>
/* --- Global Styles & Variables --- */
      /* --- Global Styles & Variables --- */
:root {
    --primary-color: #007bff; /* Blue */
    --secondary-color: #6c757d; /* Gray */
    --success-color: #28a745; /* Green */
    --light-gray-color: #f8f9fa;
    --dark-gray-color: #343a40;
    --border-color: #dee2e6;
    --step-active-bg: var(--primary-color);
    --step-active-border: var(--primary-color);
    --step-done-bg: var(--success-color);
    --step-done-border: var(--success-color);
    --step-inactive-bg: #e9ecef;
    --step-inactive-border: #ced4da;
    --step-inactive-text: var(--secondary-color);
    --body-font: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    --container-max-width: 800px;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: var(--body-font);
    background-color: var(--light-gray-color);
    color: var(--dark-gray-color);
    line-height: 1.6;
    padding: 20px;
}

.form-container {
    max-width: var(--container-max-width);
    margin: 30px auto;
    background-color: #fff;
    padding: 20px 30px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

/* --- Stepper Styles --- */
.stepper-wrapper {
    margin-bottom: 30px;
    overflow: hidden; /* Contain floats/flex items */
}

.stepper {
    display: flex;
    justify-content: space-between;
    align-items: flex-start; /* Align items at the top */
    position: relative;
}

.step {
    display: flex;
    flex-direction: column; /* Stack icon and label vertically */
    align-items: center;
    text-align: center;
    position: relative;
    flex-grow: 1; /* Allow steps to grow */
    flex-basis: 0; /* Distribute space evenly */
}

.step-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--step-inactive-bg);
    border: 2px solid var(--step-inactive-border);
    color: var(--step-inactive-text);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2em;
    margin-bottom: 5px; /* Space between icon and label */
    z-index: 2; /* Icon above connector */
    transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
}

.step-label {
    font-size: 0.9em;
    color: var(--step-inactive-text);
    transition: color 0.3s ease;
}

/* Connector Lines */
.step-connector {
    height: 2px;
    background-color: var(--step-inactive-border);
    position: absolute;
    top: 20px; /* Vertically center with the icon */
    left: 50%;
    width: 100%;
    transform: translateX(0%);
    z-index: 1; /* Below icon */
    transition: background-color 0.3s ease;
}

/* Remove connector from the last step */
.step:last-child .step-connector {
    display: none;
}

/* Active Step Styles */
.step.active .step-icon {
    background-color: var(--step-active-bg);
    border-color: var(--step-active-border);
    color: #fff;
}
.step.active .step-label {
    color: var(--primary-color);
    font-weight: bold;
}

/* Completed Step Styles */
.step.completed .step-icon {
    background-color: var(--step-done-bg);
    border-color: var(--step-done-border);
    color: #fff;
}
.step.completed .step-label {
    color: var(--step-done-bg);
}
.step.completed .step-connector {
    background-color: var(--step-done-bg);
}


/* --- Form Step Styles --- */
.form-step {
    display: none; /* Hide steps by default */
    animation: fadeIn 0.5s ease-in-out;
}

.form-step.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.step-fieldset {
    border: 1px solid var(--border-color);
    border-radius: 5px;
    padding: 20px;
    margin-bottom: 25px;
}

.step-fieldset legend {
    font-weight: bold;
    color: var(--primary-color);
    padding: 0 10px;
    width: auto; /* Override default fieldset legend width */
    border-bottom: none; /* Override default fieldset legend border */
    font-size: 1.2em;
}

/* --- Form Element Styles --- */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 0.95em;
}

.form-control {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 1em;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

/* Input Groups (Icon + Input) */
.input-group {
    display: flex;
    align-items: center;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    overflow: hidden; /* Clip corners */
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.input-group:focus-within {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.input-group-icon {
    padding: 0 12px;
    background-color: var(--light-gray-color);
    border-right: 1px solid var(--border-color);
    color: var(--secondary-color);
    align-self: stretch; /* Make icon background full height */
    display: flex;
    align-items: center;
}

.input-group .form-control {
    border: none; /* Remove border from input inside group */
    border-radius: 0; /* Remove radius from input inside group */
    flex-grow: 1;
}
.input-group .form-control:focus {
    box-shadow: none; /* Remove focus shadow from input inside group */
}

/* Checkbox Styling */
.checkbox-group {
    display: flex;
    align-items: center;
    margin-bottom: 10px; /* Smaller margin for checkboxes */
}
.checkbox-group input[type="checkbox"] {
    margin-right: 10px;
    width: 18px; /* Custom size */
    height: 18px; /* Custom size */
    cursor: pointer;
}
.checkbox-group label {
    margin-bottom: 0; /* Remove bottom margin */
    font-weight: normal; /* Normal weight for checkbox labels */
    cursor: pointer;
}

/* --- Button Styles --- */
.button-group {
    display: flex;
    justify-content: space-between; /* Pushes prev/next to ends */
    margin-top: 20px;
    flex-wrap: wrap; /* Wrap buttons on small screens */
    gap: 10px; /* Space between buttons when they wrap */
}

.button-group .btn-next,
.button-group .btn-submit {
    margin-left: auto; /* Pushes next/submit button to the right */
}


.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: background-color 0.3s ease, opacity 0.3s ease;
    display: inline-flex; /* Align icon and text */
    align-items: center;
    gap: 8px; /* Space between icon and text */
}

.btn-next, .btn-submit {
    background-color: var(--primary-color);
    color: white;
}
.btn-next:hover, .btn-submit:hover {
    background-color: #0056b3; /* Darker blue */
}
/* Loading state for next button */
.btn-next .loading-icon {
    display: none; /* Hide loading icon by default */
    width: 20px;
    height: 20px;
}
.btn-next.loading .button-text {
    display: none; /* Hide text when loading */
}
.btn-next.loading .loading-icon {
    display: inline-block; /* Show loading icon */
}
.btn-next.loading {
    opacity: 0.7;
    cursor: not-allowed;
}

.btn-prev {
    background-color: var(--secondary-color);
    color: white;
}
.btn-prev:hover {
    background-color: #5a6268; /* Darker gray */
}

/* Loading state for submit */
.btn-submit .loading-icon {
    display: none; /* Hide loading icon by default */
    width: 20px;
    height: 20px;
}
.btn-submit.loading .submit-text {
    display: none; /* Hide text when loading */
}
.btn-submit.loading .loading-icon {
    display: inline-block; /* Show loading icon */
}
.btn-submit.loading {
    opacity: 0.7;
    cursor: not-allowed;
}

/* --- Payment Method Section --- */
.payment-method {
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    margin-bottom: 15px;
}
.payment-method h4 {
    margin-bottom: 15px;
    color: var(--dark-gray-color);
}
.payment-details {
    display: flex;
    flex-wrap: wrap; /* Allow wrapping on smaller screens */
    gap: 20px;
    margin-bottom: 20px;
}
.payment-info {
    flex: 2; /* Takes more space */
    min-width: 250px; /* Prevent getting too small */
}
.payment-info ol {
    margin-left: 20px; /* Indent list */
}
.payment-qr {
    flex: 1; /* Takes less space */
    text-align: center;
    min-width: 150px;
}
.qr-image {
    max-width: 150px;
    height: auto;
    border: 1px solid var(--border-color);
    padding: 5px;
    margin-bottom: 5px;
}
.qr-caption {
    font-size: 0.9em;
    color: var(--secondary-color);
}

/* File Uploader */
.file-uploader {
    border: 2px dashed var(--border-color);
    border-radius: 5px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.3s ease;
    position: relative; /* Needed for positioning the input */
}
.file-uploader:hover {
    border-color: var(--primary-color);
}
.file-upload-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer; /* Ensure label is clickable */
    color: var(--secondary-color);
}
.file-upload-label i {
    font-size: 2em;
    margin-bottom: 10px;
    color: var(--primary-color);
}
.file-input {
    /* Visually hide the default input but keep accessible */
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}
.file-name-display {
    margin-top: 10px;
    font-size: 0.9em;
    color: var(--dark-gray-color);
    display: block; /* Ensure it takes its own line */
}

/* --- Confirmation Section --- */
.confirmation-summary h5 {
    color: var(--success-color);
    margin-bottom: 20px;
    text-align: center;
    font-size: 1.1em;
}
.summary-details {
    margin-bottom: 25px;
    border: 1px solid var(--border-color);
    padding: 15px;
    border-radius: 5px;
    background-color: var(--light-gray-color);
}
.summary-details table {
    width: 100%;
    border-collapse: collapse; /* Remove gaps between cells */
}
.summary-details td {
    padding: 8px 5px;
    border-bottom: 1px dotted var(--border-color); /* Dotted lines between rows */
    font-size: 0.95em;
}
.summary-details tr:last-child td {
    border-bottom: none; /* No border on the last row */
}
.summary-details td:first-child {
    font-weight: 600;
    width: 40%; /* Adjust width as needed */
    color: var(--secondary-color);
}
.summary-details td:last-child {
    text-align: right;
    word-break: break-word; /* Break long emails/names */
}

.terms-group {
    text-align: center; /* Center the terms checkbox */
    margin-top: 15px;
}
.terms-group label a {
    color: var(--primary-color);
    text-decoration: none;
}
.terms-group label a:hover {
    text-decoration: underline;
}

/* --- Responsive Design --- */

/* Smaller Tablets and Large Phones */
@media (max-width: 768px) {
    .form-container {
        padding: 15px;
    }

    .step-label {
        font-size: 0.8em; /* Smaller labels */
    }
    .step-icon {
        width: 35px;
        height: 35px;
        font-size: 1.1em;
    }
    .step-connector {
        top: 17px; /* Adjust connector position */
    }

    .payment-details {
        flex-direction: column; /* Stack info and QR code */
        align-items: center; /* Center items when stacked */
    }
    .payment-qr {
        width: 100%;
        max-width: 200px; /* Limit QR size */
    }
}

/* Small Phones */
@media (max-width: 480px) {
    body {
        padding: 10px;
    }
    .form-container {
        padding: 15px 10px;
    }
    .step-icon {
        width: 30px;
        height: 30px;
        font-size: 1em;
    }
    .step-connector {
        top: 15px;
    }
    .step-fieldset legend {
        font-size: 1.1em;
    }
    .btn {
        font-size: 0.9em;
        padding: 8px 15px;
    }
     .button-group {
        flex-direction: column-reverse; /* Stack buttons vertically, prev on top */
        align-items: stretch; /* Make buttons full width */
     }
     .button-group .btn-next,
     .button-group .btn-submit {
         margin-left: 0; /* Reset margin */
     }
     .summary-details td {
        font-size: 0.9em;
     }
     .summary-details td:first-child {
        width: 35%;
     }
}
.checkout-container {
            max-width: 600px;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 1px;
        }

        .checkout-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .checkout-header h1 {
            font-size: 24px;
            color: #333;
        }

        .checkout-item {
            margin-bottom: 20px;
           
            align-items: center;
            transition: all 0.3s ease;
        }

        .checkout-item img {
            max-width: 100%;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .checkout-summary {
            margin-top: 20px;
            font-size: 18px;
            color: #555;
            transition: all 0.3s ease;
        }

        .checkout-summary p {
            margin: 10px 0;
        }

        .checkout-actions {
            text-align: center;
            margin-top: 30px;
        }

        .checkout-actions button {
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: #2ecc71;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .checkout-actions button:hover {
            background-color: #27ae60;
        }

        .hidden {
            display: none;
        }


        .checkout-item.compact img {
            max-width: 100px;
            margin-right: 20px;
        }

        .checkout-item.compact .checkout-summary {
            margin-left: 20px;
        }

        .checkout-item.compact {
        display: flex;
        align-items: center;
    }
    </style>
</head>
<body>
<div class="checkout-container">
        <div class="checkout-header">
            <h1>Compra R√°pida</h1>
        </div>
        <div class="checkout-item" id="checkout-item">
            <img id="product-image" src="" alt="Product Image">
            <div class="checkout-summary">
                <p><strong>Producto:</strong> <span id="product-name"></span></p>
                <p><strong>Color:</strong> <span id="product-color"></span></p>
                <p><strong>Cantidad:</strong> <span id="product-quantity"></span></p>
                <p><strong>Precio:</strong> <span id="product-price"></span></p>
            </div>
        </div>
        <div class="checkout-actions">
            <button onclick="confirmPurchase()">Confirmar Compra</button>
        </div>
    </div>
<div class="form-container hidden">
    <form id="multiStepForm">
        <div class="stepper-wrapper">
            <div class="stepper">
                <div class="step step-1 active" data-step-target="1">
                    <div class="step-icon"><i class="fas fa-user"></i></div>
                    <div class="step-label">Datos</div>
                    <div class="step-connector"></div>
                </div>
                <div class="step step-2" data-step-target="2">
                     <div class="step-icon"><i class="fas fa-credit-card"></i></div>
                    <div class="step-label">Pago</div>
                    <div class="step-connector"></div>
               </div>
                <div class="step step-3" data-step-target="3">
                     <div class="step-icon"><i class="fas fa-check"></i></div>
                    <div class="step-label">Confirmar</div>
                 </div>
            </div>
        </div>

        <div class="form-content">

            <div class="form-step active" data-step="1">
                <fieldset class="step-fieldset">
                    <legend>Datos Personales</legend>
                    <div class="form-group">
                        <label for="nombre">Nombres:</label>
                        <div class="input-group">
                            <span class="input-group-icon"><i class="fas fa-user"></i></span>
                            <input type="text" id="nombre" name="nombre" class="form-control" placeholder="Ingrese sus nombres" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="apellido">Apellidos:</label>
                        <div class="input-group">
                            <span class="input-group-icon"><i class="fas fa-user"></i></span>
                            <input type="text" id="apellido" name="apellido" class="form-control" placeholder="Ingrese sus apellidos" required>
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="celular">Celular:</label>
                        <div class="input-group">
                            <span class="input-group-icon"><i class="fas fa-phone-alt"></i></span>
                            <input type="tel" id="celular" name="celular" class="form-control" placeholder="Ingrese su celular" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="direccion">Direcci√≥n:</label>
                        <div class="input-group">
                            <span class="input-group-icon"><i class="fas fa-map-marker-alt"></i></span>
                            <input type="text" id="direccion" name="direccion" class="form-control" placeholder="Ingrese su direcci√≥n" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ciudad">Ciudad:</label>
                        <div class="input-group">
                            <span class="input-group-icon"><i class="fas fa-city"></i></span>
                            <input type="text" id="ciudad" name="ciudad" class="form-control" placeholder="Ingrese su ciudad" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="referencia">Referencia:</label>
                        <div class="input-group">
                            <span class="input-group-icon"><i class="fas fa-info-circle"></i></span>
                            <input type="text" id="referencia" name="referencia" class="form-control" placeholder="Ingrese una referencia" required>
                        </div>
                    </div>
                    <div class="form-group">
                         <label for="email">Correo Electr√≥nico:</label>
                        <div class="input-group">
                             <span class="input-group-icon"><i class="fas fa-at"></i></span>
                            <input type="email" id="email" name="email" class="form-control" placeholder="Ingrese su correo" required>
                        </div>
                    </div>
                     <div class="form-group">
                         <label for="repetir_email">Confirmar Correo:</label>
                        <div class="input-group">
                             <span class="input-group-icon"><i class="fas fa-at"></i></span>
                            <input type="email" id="repetir_email" name="repetir_email" class="form-control" placeholder="Repita su correo" required>
                            </div>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="guardar_datos" name="guardar_datos" value="1">
                        <label for="guardar_datos">Guardar datos para una pr√≥xima compra</label>
                     </div>
                     <div class="form-group checkbox-group">
                        <input type="checkbox" id="suscribirse" name="suscribirse" value="1" checked>
                        <label for="suscribirse">Deseo suscribirme al bolet√≠n</label>
                     </div>
                 </fieldset>
                 <div class="button-group">
                     <button type="button" class="btn btn-next">Continuar <i class="fas fa-chevron-right"></i></button>
                 </div>
            </div>

            <div class="form-step" data-step="2">
                <fieldset class="step-fieldset">
                     <legend>M√©todo de Pago</legend>
                     <div class="payment-method active" id="billetera">
                         <h4>Billetera Digital (Yape)</h4>
                         <div class="payment-details">
                             <div class="payment-info">
                                 <p><strong>N√∫mero:</strong> 912446440</p>
                                 <p><strong>Titular **Importante:**</strong></p>Claudio Patricio Rodriguez Espinoza</p>
                                 <p><strong>Instrucciones:</strong></p>
                                 <ol>
                                     <li>Ingrese a su app YAPE</li>
                                     <li>Busque/Ingrese el n√∫mero.</li>
                                     <li>Seleccione pagar e ingrese el monto total.</li>
                                     <li>**Importante:** En la referencia/comentario del pago, indique su n√∫mero de WhatsApp.</li>
                                 </ol>
                             </div>
                             <div class="payment-qr">
                                 <img src="/yapeqr.png" alt="QR Code Yape/Plin" class="qr-image">
                                 <p class="qr-caption">Escanear QR (Opcional)</p>
                            </div>
                         </div>

                         <div class="form-group">
                            <label for="comprobante">Adjuntar Comprobante:</label>
                             <div class="file-uploader">
                                 <label for="comprobante" class="file-upload-label">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Seleccionar archivo o arrastrar aqu√≠</span>
                                </label>
                                <input type="file" id="comprobante" name="myfile" accept="image/*,application/pdf" required class="file-input">
                                <span id="uploadStatus" class="file-name-display">Ning√∫n archivo seleccionado</span>
                             </div>
                         </div>

                        <input type="hidden" name="payment_method_selected" value="billetera_digital">
                    </div>
                </fieldset>
                <div class="button-group">
                    <button type="button" class="btn btn-prev"><i class="fas fa-chevron-left"></i> Atr√°s</button>
                    <button type="button" class="btn btn-next" id="btnNextStep2">
                        <span class="button-text">Continuar</span>
                        <img class="loading-icon" src="https://storegamesperu.com/files/images/loading_button.gif" alt="Cargando...">
                    </button>
                  </div>
            </div>

            <div class="form-step" data-step="3">
                <fieldset class="step-fieldset confirmation-summary">
                     <legend>Confirmar Orden</legend>
                    <h5><i class="fas fa-check-circle"></i> Revise que la informaci√≥n sea correcta</h5>
                    <div class="summary-details">
                        <table>
                            <tbody>
                                <tr>
                                    <td>Nombre Completo:</td>
                                    <td id="confirmName"></td>
                                </tr>
                                <tr>
                                    <td>Celular:</td>
                                    <td id="confirmPhone"></td>
                                </tr>
                                <tr>
                                    <td>Direcci√≥n:</td>
                                    <td id="confirmDireccion"></td>
                                </tr>
                                <tr>
                                    <td>Ciudad:</td>
                                    <td id="confirmCiudad"></td>
                                </tr>
                                <tr>
                                    <td>Referencia:</td>
                                    <td id="confirmReferencia"></td>
                                </tr>
                                <tr>
                                    <td>Correo:</td>
                                    <td id="confirmEmail"></td>
                                 </tr>
                                 <tr>
                                     <td>M√©todo de Pago:</td>
                                    <td id="confirmPayment">Yape Billetera Digital</td> </tr>
                                <tr>
                                    <td>Monto Pagado:</td>
                                    <td id="confirmTotalPrice"></td>
                                </tr>
                                 <tr>
                                    <td>Comprobante:</td>
                                    <td id="confirmReceiptFile"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="form-group terms-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="acepto_terminos" name="acepto" required>
                            <label for="acepto_terminos">Acepto los <a href="https://storegamesperu.com/terminos-y-condiciones" target="_blank">T√©rminos y Condiciones</a>.</label>
                        </div>
                    </div>
                </fieldset>
                <div class="button-group">
                     <button type="button" class="btn btn-prev"><i class="fas fa-chevron-left"></i> Atr√°s</button>
                     <button type="submit" class="btn btn-submit">
                         <span class="submit-text">Realizar Compra</span>
                         <img class="loading-icon" src="https://storegamesperu.com/files/images/loading_button.gif" alt="Cargando...">
                    </button>
                 </div>
             </div>
        </div> </form> </div>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const params = new URLSearchParams(window.location.search);
                const productName = params.get('product');
                const productColor = params.get('color');
                const productQuantity = params.get('quantity');
                const productPrice = params.get('price'); // Retrieve the price from the URL

                    // Extract the color name from the file path
    const colorName = productColor
        .split('/') // Split the path by '/'
        .pop() // Get the last part (filename)
        .replace('.webp', '') // Remove the file extension
        .split('-') // Split the filename by '-'
        .slice(-2) // Get the last two words
        .join('-'); // Join them back with '-'
    
                    // Populate the checkout page
    document.getElementById('product-image').src = productColor;
    document.getElementById('product-name').textContent = productName;
    document.getElementById('product-color').textContent = colorName;
    document.getElementById('product-quantity').textContent = productQuantity;
    
                // Calculate and display the total price
    const pricePerItem = parseFloat(productPrice.replace('S/', '')); // Convert price to a number
    const totalPrice = (pricePerItem * productQuantity).toFixed(2);
    document.getElementById('product-price').textContent = `S/${totalPrice}`;
            });
    
            function confirmPurchase() {
                const checkoutItem = document.getElementById('checkout-item');
                const formContainer = document.querySelector('.form-container'); // Select the form container
                const confirmButton = document.querySelector('.checkout-actions button'); // Select the "Confirmar Compra" button
    
                // Adjust layout
                checkoutItem.classList.add('compact');
                formContainer.classList.remove('hidden'); // Show the form container
                    // Hide the "Confirmar Compra" button
                confirmButton.style.display = 'none';
            }
    
            function submitDetails() {
                alert('Detalles enviados correctamente.');
                // Add your form submission logic here
            }
        </script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
    const multiStepForm = document.getElementById('multiStepForm');
    const steps = Array.from(multiStepForm.querySelectorAll('.form-step'));
    const stepperItems = Array.from(multiStepForm.querySelectorAll('.stepper .step'));
    const nextButtons = multiStepForm.querySelectorAll('.btn-next');
    const prevButtons = multiStepForm.querySelectorAll('.btn-prev');
    const submitButton = multiStepForm.querySelector('.btn-submit');
    const fileInput = document.getElementById('comprobante');
    const fileNameDisplay = multiStepForm.querySelector('.file-name-display');
    const hiddenFileInput = multiStepForm.querySelector('.hidden-file-input'); // For potential form submission

    let currentStep = 0;

    // Function to show the current step and update stepper
    function showStep(stepIndex) {
        // Hide all steps
        steps.forEach(step => step.classList.remove('active'));
        // Show the target step
        steps[stepIndex].classList.add('active');

        // Update stepper visuals
        stepperItems.forEach((item, index) => {
            item.classList.remove('active', 'completed');
            if (index < stepIndex) {
                item.classList.add('completed');
            } else if (index === stepIndex) {
                item.classList.add('active');
            }
        });
        currentStep = stepIndex;
    }

    // Function to validate inputs in the current step (Basic Example)
    function validateStep(stepIndex) {
        let isValid = true;
        const currentStepInputs = steps[stepIndex].querySelectorAll('input[required], select[required], textarea[required]');

        currentStepInputs.forEach(input => {
            if (!input.value.trim()) {
                isValid = false;
                // Optional: Add error indication (e.g., border color)
                input.style.borderColor = 'red'; // Simple indication
            } else {
                input.style.borderColor = ''; // Reset border color
                // Specific validations
                if (input.type === 'email' && input.name === 'repetir_email') {
                    const emailInput = steps[stepIndex].querySelector('input[name="email"]');
                    if (input.value.trim() !== emailInput.value.trim()) {
                        isValid = false;
                        input.style.borderColor = 'red';
                        // Optional: Show a specific message
                        console.error("Emails don't match");
                    }
                }
            }
        });
        // Validation for terms checkbox on the last step before submit
        if (stepIndex === steps.length - 1) {
             const termsCheckbox = multiStepForm.querySelector('#acepto_terminos');
             if (!termsCheckbox.checked) {
                 isValid = false;
                 // Optional: Highlight terms area
                 termsCheckbox.parentNode.style.color = 'red'; // Simple indication
             } else {
                 termsCheckbox.parentNode.style.color = ''; // Reset color
             }
        }


        return isValid;
    }

    // Function to populate confirmation details
    function populateConfirmation() {
    const nombre = multiStepForm.querySelector('#nombre').value;
    const apellido = multiStepForm.querySelector('#apellido').value;
    const celular = multiStepForm.querySelector('#celular').value;
    const direccion = multiStepForm.querySelector('#direccion').value; // New field
    const ciudad = multiStepForm.querySelector('#ciudad').value; // New field
    const referencia = multiStepForm.querySelector('#referencia').value; // New field
    const email = multiStepForm.querySelector('#email').value;
    const comprobanteFile = fileInput.files.length > 0 ? fileInput.files[0].name : 'No adjuntado';

        document.getElementById('confirmName').textContent = `${nombre} ${apellido}`;
        document.getElementById('confirmPhone').textContent = celular;
        document.getElementById('confirmEmail').textContent = email;
        document.getElementById('confirmReceiptFile').textContent = comprobanteFile;
    // Add new fields to the confirmation summary
    document.getElementById('confirmDireccion').textContent = direccion;
    document.getElementById('confirmCiudad').textContent = ciudad;
    document.getElementById('confirmReferencia').textContent = referencia;
        // Populate the total price
    const totalPrice = document.getElementById('product-price').textContent;
    document.getElementById('confirmTotalPrice').textContent = totalPrice;

    
}

    // Add event listeners to NEXT buttons
    nextButtons.forEach(button => {
    button.addEventListener('click', async () => {
        // Reset previous validation styles
        const currentStepInputs = steps[currentStep].querySelectorAll('input, select, textarea');
        currentStepInputs.forEach(input => input.style.borderColor = '');

        // Validate the current step
        if (validateStep(currentStep)) {
            // Check if the button is the one for step 2 (btnNextStep2)
            if (button.id === 'btnNextStep2') {
                // Add loading state to the button
                button.classList.add('loading');
                button.disabled = true;

                try {
                    const uploadSuccess = await uploadFileToFirebase();
                    if (!uploadSuccess) {
                        throw new Error('Error al subir el archivo.');
                    }
                } catch (error) {
                    alert(error.message);
                    console.error(error);
                    return; // Stop if the file upload fails
                } finally {
                    // Remove loading state from the button
                    button.classList.remove('loading');
                    button.disabled = false;
                }
            }

            // Proceed to the next step
            if (currentStep < steps.length - 1) {
                if (currentStep === steps.length - 2) { // Before showing confirmation
                    populateConfirmation();
                }
                showStep(currentStep + 1);
            }
        } else {
            alert('Por favor, complete todos los campos requeridos correctamente.');
        }
    });
});

    // Add event listeners to PREV buttons
    prevButtons.forEach(button => {
        button.addEventListener('click', () => {
            if (currentStep > 0) {
                showStep(currentStep - 1);
            }
        });
    });

    // Handle Form Submission
    multiStepForm.addEventListener('submit', (e) => {
        e.preventDefault(); // Prevent default browser submission

         // Final validation check on the last step
        if (!validateStep(steps.length - 1)) {
            alert('Por favor, acepte los t√©rminos y condiciones para continuar.');
            return; // Stop submission if validation fails
        }

        // Show loading state
        submitButton.classList.add('loading');
        submitButton.disabled = true;

        console.log('Form submitted!');
        // --- HERE YOU WOULD TYPICALLY SEND DATA TO YOUR SERVER ---
        // Example: using Fetch API
        // const formData = new FormData(multiStepForm);
        // fetch('your-server-endpoint', {
        //     method: 'POST',
        //     body: formData
        // })
        // .then(response => response.json())
        // .then(data => {
        //     console.log('Success:', data);
        //     // Redirect to a thank you page or show success message
        //     window.location.href = 'thank-you.html';
        // })
        // .catch((error) => {
        //     console.error('Error:', error);
        //     alert('Hubo un error al procesar su compra.');
        //     // Hide loading state on error
        //     submitButton.classList.remove('loading');
        //     submitButton.disabled = false;
        // });

        // --- Simulate submission for demonstration ---
        setTimeout(() => {
             alert('¬°Compra realizada con √©xito!');
             // Hide loading state
             submitButton.classList.remove('loading');
             submitButton.disabled = false;
             // Optionally reset form or redirect
             // multiStepForm.reset();
             // showStep(0);
             // fileNameDisplay.textContent = 'Ning√∫n archivo seleccionado';
        }, 2000); // Simulate network delay
    });

    // Handle file input change
    if (fileInput && fileNameDisplay) {
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileNameDisplay.textContent = fileInput.files[0].name;
                // If using the hidden form for upload:
                // hiddenFileInput.files = fileInput.files; // Sync files if needed for direct form submission
            } else {
                fileNameDisplay.textContent = 'Ning√∫n archivo seleccionado';
            }
        });
    }

    // Initialize - Show the first step
    showStep(0);
});
    </script>
</body>
</html>
